# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country))  %>%
select(-r1_d)
View(anc_calc_info)
View(amgd)
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv")
View(anc_calc_info)
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner", Sample_alias, Secondary_sample_accession)),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country))
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country))
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII|Warinner"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country)) %>%
select(-r1_d) %>%
unique()
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII|Warinner"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country)) %>%
select(-r1_d) %>%
unique()
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII|Warinner"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country)) %>%
select(-r1_d) %>%
unique() %>%
# Ok now fix the country
mutate(Continent = ifelse(Study == "Pacific", "Oceania",Continent),
Continent = ifelse(str_detect(Country, "Morocco|Egypt|South Africa|Ethiopia|Sierra Leone|Sudan"),"Africa",
ifelse(str_detect(Country, "Taiwan|Japan|Mongolia|Nepal"),"Asia",
ifelse(str_detect(Country, "USA|Belize"), "North America",
ifelse(str_detect(Country, "Guadeloupe"),"Caribbean",Continent)))))
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII|Warinner"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country)) %>%
select(-r1_d) %>%
unique() %>%
# Ok now fix the country
mutate(Continent = ifelse(Study == "Pacific", "Oceania",Continent),
Continent = ifelse(str_detect(Country, "Morocco|Egypt|South Africa|Ethiopia|Sierra Leone|Sudan"),"Africa",
ifelse(str_detect(Country, "Taiwan|Japan|Mongolia|Nepal"),"Asia",
ifelse(str_detect(Country, "USA|Belize"), "North America",
ifelse(str_detect(Country, "Guadeloupe"),"Caribbean",Continent))))) %>%
arrange(Continent, Country)
knitr::opts_knit$set(root.dir = normalizePath(".."))
# NEED to fix the COUNTRY for all of these (now it's set to Europe for all)
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII|Warinner"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country)) %>%
select(-r1_d) %>%
unique() %>%
# Ok now fix the country
mutate(Continent = ifelse(Study == "Pacific", "Oceania",Continent),
Continent = ifelse(str_detect(Country, "Morocco|Egypt|South Africa|Ethiopia|Sudan"),"Africa",
ifelse(str_detect(Country, "Taiwan|Japan|Mongolia|Nepal"),"Asia",
ifelse(str_detect(Country, "USA|Belize"), "North America",
ifelse(str_detect(Country, "Guadeloupe"),"Caribbean",Continent))))) %>%
arrange(Continent, Country)
knitr::opts_knit$set(root.dir = normalizePath(".."))
mod_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "modern_calculus")) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "calculus",
Continent  = "Europe",
Paired = "Yes") %>%
full_join(., fread("00-documentation/mod_calc_r1_depth.csv")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired)
knitr::opts_knit$set(root.dir = normalizePath(".."))
combined_meta_info <- cmc_info %>%
full_join(., mgnifyinfo)  %>%
full_join(., zhuinfo) %>%
full_join(., pasolliinfo) %>%
full_join(., clemente_lassalle_info) %>%
full_join(., pedroinfo) %>%
full_join(., mod_calc_info) %>%
full_join(., anc_calc_info) %>%
# now add directional info (western/eastern) and industrialization
mutate(Direction = ifelse(str_detect(Continent, "North America|Europe|Australia"), "Western",
ifelse(str_detect(Country, "China|Japan"), "Eastern",
ifelse(Country == "not provided", "Unknown", "Global South")))) %>%
mutate(Industrialization = ifelse(str_detect(Study, "Velsko2023|Clemente|Lassalle|Pedro"), "Non_industrial", "Industrial"))
View(combined_meta_info)
knitr::opts_knit$set(root.dir = normalizePath(".."))
combined_meta_info <- cmc_info %>%
full_join(., mgnifyinfo)  %>%
full_join(., zhuinfo) %>%
full_join(., pasolliinfo) %>%
full_join(., clemente_lassalle_info) %>%
full_join(., pedroinfo) %>%
full_join(., mod_calc_info) %>%
# now add directional info (western/eastern) and industrialization
mutate(Direction = ifelse(str_detect(Continent, "North America|Europe|Australia"), "Western",
ifelse(str_detect(Country, "China|Japan"), "Eastern",
ifelse(Country == "not provided", "Unknown", "Global South")))) %>%
mutate(Industrialization = ifelse(str_detect(Study, "Velsko2023|Clemente|Lassalle|Pedro"), "Non_industrial", "Industrial")) %>%
full_join(., anc_calc_info %>%
mutate(Direction  = "Ancient"),
Industrialization = "Ancient")
knitr::opts_knit$set(root.dir = normalizePath(".."))
combined_meta_info <- cmc_info %>%
full_join(., mgnifyinfo)  %>%
full_join(., zhuinfo) %>%
full_join(., pasolliinfo) %>%
full_join(., clemente_lassalle_info) %>%
full_join(., pedroinfo) %>%
full_join(., mod_calc_info) %>%
# now add directional info (western/eastern) and industrialization
mutate(Direction = ifelse(str_detect(Continent, "North America|Europe|Australia"), "Western",
ifelse(str_detect(Country, "China|Japan"), "Eastern",
ifelse(Country == "not provided", "Unknown", "Global South")))) %>%
mutate(Industrialization = ifelse(str_detect(Study, "Velsko2023|Clemente|Lassalle|Pedro"), "Non_industrial", "Industrial")) %>%
full_join(., anc_calc_info %>%
mutate(Direction  = "Ancient",
Industrialization = "Ancient"))
# mean depth by study
combined_meta_info %>%
# remove the MGNify entries b/c they're already averaged
filter(MAG_source != "MGNify") %>%
group_by(Study, Secondary_sample_accession) %>%
summarize(total_reads = sum(R1_depth)) %>%
ungroup() %>%
group_by(Study) %>%
summarize(mean_depth = mean(total_reads)) %>%
ungroup() %>%
# now add the MGNify entries back
bind_rows(., combined_meta_info %>%
filter(MAG_source == "MGNify") %>%
select(Study, R1_depth) %>%
distinct() %>%
group_by(Study) %>%
summarize(mean_depth = sum(R1_depth)) %>%
ungroup())
# mean depth by study  and read pairing
combined_meta_info %>%
# remove the MGNify entries b/c they're already averaged
filter(MAG_source != "MGNify") %>%
group_by(Study, Paired) %>%
summarize(mean_depth = mean(R1_depth)) %>%
ungroup() %>%
# now add the MGNify entries back
bind_rows(., combined_meta_info %>%
filter(MAG_source == "MGNify") %>%
select(Study, Paired, R1_depth) %>%
distinct() %>%
rename(mean_depth = R1_depth))
# mean depth by oral site
combined_meta_info %>%
# remove the MGNify entries b/c they're already averaged
filter(MAG_source != "MGNify") %>%
group_by(Oral_site, Secondary_sample_accession) %>%
summarize(total_reads = sum(R1_depth)) %>%
ungroup() %>%
bind_rows(., combined_meta_info %>%
filter(MAG_source == "MGNify") %>%
select(Study, Oral_site, R1_depth) %>%
distinct() %>%
group_by(Study, Oral_site) %>%
summarize(total_reads = sum(R1_depth))) %>%
group_by(Oral_site) %>%
summarize(mean_depth = mean(total_reads),
sd_depth = sd(total_reads)) %>%
ungroup()
# number of samples per study
combined_meta_info %>%
select(Secondary_sample_accession, Study) %>%
group_by(Study) %>%
count(name = "samples_per_study")
# number of samples per oral site
combined_meta_info %>%
select(Secondary_sample_accession, Oral_site) %>%
group_by(Oral_site) %>%
count(name = "samples_per_oral_site")
# number of samples per continent
combined_meta_info %>%
select(Secondary_sample_accession, Continent) %>%
group_by(Continent) %>%
count(name = "samples_per_continent")
# number of samples per oral site per continent
combined_meta_info %>%
select(Secondary_sample_accession, Continent, Oral_site) %>%
group_by(Continent, Oral_site) %>%
count(name = "samples_per_os_per_continent")
# number of samples per western/eastern/neither
combined_meta_info %>%
select(Secondary_sample_accession, Direction) %>%
group_by(Direction) %>%
count()
# number of samples per oral site per western/eastern/neither
combined_meta_info %>%
select(Secondary_sample_accession, Direction, Oral_site) %>%
group_by(Direction, Oral_site) %>%
count()
# number of samples per industrialization status
combined_meta_info %>%
select(Secondary_sample_accession, Industrialization) %>%
group_by(Industrialization) %>%
count()
# number of samples per industrialization status
combined_meta_info %>%
select(Secondary_sample_accession, Industrialization, Oral_site) %>%
group_by(Industrialization, Oral_site) %>%
count()
knitr::opts_knit$set(root.dir = normalizePath(".."))
anc_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "ancient_calculus")) %>%
mutate(Secondary_sample_accession = ifelse(str_detect(Study,"RIII|Warinner"), Sample_alias, Secondary_sample_accession),
Secondary_sample_accession = ifelse(str_detect(Sample_alias, "HPD"), Sample_alias, Secondary_sample_accession)) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "anc_calculus",
Continent  = "Europe",
Paired = "Yes") %>%
left_join(., fread("https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/master/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv") %>%
rename(Secondary_sample_accession = archive_sample_accession,
R1_depth = read_count) %>%
select(Secondary_sample_accession, R1_depth), by = "Secondary_sample_accession") %>%
# remove samples that  aren't included
filter(!str_detect(Study, "POMI"),
!str_detect(Secondary_sample_accession, "SMH005.A0102|SMH007.A0102|SMH008.A0102|ERS6256710|ERS6256715")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired) %>%
# add missing Pacific data
full_join(., pac_reads %>%
bind_rows(., r3) %>%
rename(r1_d = R1_depth), by = "Secondary_sample_accession") %>%
mutate(R1_depth = ifelse(str_detect(Study,"Pacific|RIII|Warinner"),r1_d, R1_depth)) %>%
mutate(Country = ifelse(str_detect(Secondary_sample_accession, "HPD"),"Taiwan",Country)) %>%
select(-r1_d) %>%
unique() %>%
# Ok now fix the country
mutate(Continent = ifelse(Study == "Pacific", "Oceania",Continent),
Continent = ifelse(str_detect(Country, "Morocco|Egypt|South Africa|Ethiopia|Sudan"),"Africa",
ifelse(str_detect(Country, "Taiwan|Japan|Mongolia|Nepal"),"Asia",
ifelse(str_detect(Country, "USA|Belize"), "North America",
ifelse(str_detect(Country, "Guadeloupe"),"Caribbean",Continent))))) %>%
arrange(Continent, Country)
knitr::opts_knit$set(root.dir = normalizePath(".."))
mod_calc_info <- fread("./00-documentation/library_sample_eager_metadata.tsv") %>%
filter(str_detect(Sample_group, "modern_calculus")) %>%
select(Study, Secondary_sample_accession, Run_accession, Country, Age_BP) %>%
mutate(MAG_source = Study,
Oral_site = "mod_calculus",
Continent  = "Europe",
Paired = "Yes") %>%
full_join(., fread("00-documentation/mod_calc_r1_depth.csv")) %>%
select(MAG_source,Study,Secondary_sample_accession,Oral_site,Age_BP,Country,Continent,R1_depth,Paired)
knitr::opts_knit$set(root.dir = normalizePath(".."))
combined_meta_info <- cmc_info %>%
full_join(., mgnifyinfo)  %>%
full_join(., zhuinfo) %>%
full_join(., pasolliinfo) %>%
full_join(., clemente_lassalle_info) %>%
full_join(., pedroinfo) %>%
full_join(., mod_calc_info) %>%
# now add directional info (western/eastern) and industrialization
mutate(Direction = ifelse(str_detect(Continent, "North America|Europe|Australia"), "Western",
ifelse(str_detect(Country, "China|Japan"), "Eastern",
ifelse(Country == "not provided", "Unknown", "Global South")))) %>%
mutate(Industrialization = ifelse(str_detect(Study, "Velsko2023|Clemente|Lassalle|Pedro"), "Non_industrial", "Industrial")) %>%
full_join(., anc_calc_info %>%
mutate(Direction  = "Ancient",
Industrialization = "Ancient"))
# mean depth by study
combined_meta_info %>%
# remove the MGNify entries b/c they're already averaged
filter(MAG_source != "MGNify") %>%
group_by(Study, Secondary_sample_accession) %>%
summarize(total_reads = sum(R1_depth)) %>%
ungroup() %>%
group_by(Study) %>%
summarize(mean_depth = mean(total_reads)) %>%
ungroup() %>%
# now add the MGNify entries back
bind_rows(., combined_meta_info %>%
filter(MAG_source == "MGNify") %>%
select(Study, R1_depth) %>%
distinct() %>%
group_by(Study) %>%
summarize(mean_depth = sum(R1_depth)) %>%
ungroup())
# mean depth by study  and read pairing
combined_meta_info %>%
# remove the MGNify entries b/c they're already averaged
filter(MAG_source != "MGNify") %>%
group_by(Study, Paired) %>%
summarize(mean_depth = mean(R1_depth)) %>%
ungroup() %>%
# now add the MGNify entries back
bind_rows(., combined_meta_info %>%
filter(MAG_source == "MGNify") %>%
select(Study, Paired, R1_depth) %>%
distinct() %>%
rename(mean_depth = R1_depth))
# mean depth by oral site
combined_meta_info %>%
# remove the MGNify entries b/c they're already averaged
filter(MAG_source != "MGNify") %>%
group_by(Oral_site, Secondary_sample_accession) %>%
summarize(total_reads = sum(R1_depth)) %>%
ungroup() %>%
bind_rows(., combined_meta_info %>%
filter(MAG_source == "MGNify") %>%
select(Study, Oral_site, R1_depth) %>%
distinct() %>%
group_by(Study, Oral_site) %>%
summarize(total_reads = sum(R1_depth))) %>%
group_by(Oral_site) %>%
summarize(mean_depth = mean(total_reads),
sd_depth = sd(total_reads)) %>%
ungroup()
# number of samples per study
combined_meta_info %>%
select(Secondary_sample_accession, Study) %>%
group_by(Study) %>%
count(name = "samples_per_study")
# number of samples per oral site
combined_meta_info %>%
select(Secondary_sample_accession, Oral_site) %>%
group_by(Oral_site) %>%
count(name = "samples_per_oral_site")
# number of samples per continent
combined_meta_info %>%
select(Secondary_sample_accession, Continent) %>%
group_by(Continent) %>%
count(name = "samples_per_continent")
# number of samples per oral site per continent
combined_meta_info %>%
select(Secondary_sample_accession, Continent, Oral_site) %>%
group_by(Continent, Oral_site) %>%
count(name = "samples_per_os_per_continent")
# number of samples per western/eastern/neither
combined_meta_info %>%
select(Secondary_sample_accession, Direction) %>%
group_by(Direction) %>%
count()
# number of samples per oral site per western/eastern/neither
combined_meta_info %>%
select(Secondary_sample_accession, Direction, Oral_site) %>%
group_by(Direction, Oral_site) %>%
count()
# number of samples per industrialization status
combined_meta_info %>%
select(Secondary_sample_accession, Industrialization) %>%
group_by(Industrialization) %>%
count()
# number of samples per industrialization status
combined_meta_info %>%
select(Secondary_sample_accession, Industrialization, Oral_site) %>%
group_by(Industrialization, Oral_site) %>%
count()
View(combined_meta_info)
q()
